/*** BeginHeader */
#ifndef __RCM42_58MHZ_IOCONFIG_LIB
#define __RCM42_58MHZ_IOCONFIG_LIB
/*** EndHeader */

/* START LIBRARY DESCRIPTION ************************************************
RCM42_58MHZ_IOCONFIG.LIB
DESCRIPTION:
 This library was generated by the Rabbit 4000 I/O LIB Utility.
 If it is modified in any incorrect way it might not load properly.
 Usage:
 #use "RCM42_58MHZ_IOCONFIG.LIB"
 main()
 {
    serDEconfig();
    ...
 }

SUPPORT LIBRARIES: none
END DESCRIPTION *************************************************************/

/*** BeginHeader  serDEconfig */
void serDEconfig();
void ClockCheck();
void SetupSerial();
#define DINBUFSIZE  127
#define DOUTBUFSIZE  127
#define SERD_TXPORT  PCDR
#define DDRIVE_TXD  0
#define SERD_RXPORT  PCDR
#define DDRIVE_RXD  1
/*** EndHeader */

/* START FUNCTION DESCRIPTION ***********************************************
serDEconfig                <RCM42_58MHZ_IOCONFIG.LIB>
void serDEconfig(void);

Configures serial port D for use with RCM4200 boards on an RCM4200 prototyping 
board.

Serial port D is configured to use PC1 and PC0.

Note that serial port E is not available on the RCM4200.
END DESCRIPTION *************************************************************/

void ClockCheck()
{
   if (freq_divider != 96) // 29.49 MHz, doubled
   {
      exception(-ERR_LIBCLOCKSPEED);
   }
}

void SetupSerial()
{
   serDopen(19200L);
   serDdmaOn(DMA_CHANNEL_ANY, DMA_CHANNEL_ANY);
}

void serDEconfig()
{
   ClockCheck();
   // The following differ from BIOS settings
   SetupSerial();
   WrPortI(PCFR,&PCFRShadow,0x41);     // Serial Port D
}

// The following are used by the configuration utility
// Restore(SDDLR, 0xBF)      // Serial Port D
// Restore(APID, 0x01)      // Serial Port D
// Restore(DBL, 0x01)      // Processor Options
// Restore(DINBF, 0x7F)      // Serial Port D
// Restore(DOUTBF, 0x7F)      // Serial Port D
// Restore(SDDMA, 0x01)      // Serial Port D
// Restore(USEPD, 0x01)      // Serial Port D

/*** BeginHeader */
#endif
/*** EndHeader */
//checksum:8F64